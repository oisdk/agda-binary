{-# OPTIONS --without-K --safe #-}

module Data.Binary.Operations.Addition where

open import Data.Binary.Definitions
open import Data.Binary.Operations.Unary
open import Data.Nat as â„• using (â„•; suc; zero)

mutual
  0â†’âŸ¨0?+0âŸ© : 0â‰¤ ğ”¹â‚€ â†’ â„• â†’ ğ”¹â‚ â†’ ğ”¹â‚€
  0â†’âŸ¨0?+0âŸ© 0â‚‚ yâ‚€ ys = yâ‚€ 0& ys
  0â†’âŸ¨0?+0âŸ© (0< xs) yâ‚€ ys = 0â†’âŸ¨0+0âŸ© (Hâ‚€ xs) (Tâ‚€ xs) yâ‚€ ys

  0â†’âŸ¨0+0âŸ© : â„• â†’ ğ”¹â‚ â†’ â„• â†’ ğ”¹â‚ â†’ ğ”¹â‚€
  0â†’âŸ¨0+0âŸ© zero     xs zero     ys = sucâ‚€ 0â†’âŸ¨1+1âŸ© (Hâ‚ xs) (Tâ‚ xs) (Hâ‚ ys) (Tâ‚ ys)
  0â†’âŸ¨0+0âŸ© zero     xs (suc yâ‚€) ys = 0 0& 0â†’âŸ¨1+0âŸ© (Hâ‚ xs) (Tâ‚ xs) yâ‚€ ys
  0â†’âŸ¨0+0âŸ© (suc xâ‚€) xs zero     ys = 0 0& 0â†’âŸ¨1+0âŸ© (Hâ‚ ys) (Tâ‚ ys) xâ‚€ xs
  0â†’âŸ¨0+0âŸ© (suc xâ‚€) xs (suc yâ‚€) ys = sucâ‚€ 0â†’âŸ¨0+0âŸ© xâ‚€ xs yâ‚€ ys

  0â†’âŸ¨1+0?âŸ© : ğ”¹â‚ â†’ 0â‰¤ ğ”¹â‚€ â†’ ğ”¹â‚
  0â†’âŸ¨1+0?âŸ© xs 0â‚‚ = xs
  0â†’âŸ¨1+0?âŸ© xs (0< ys) = 0â†’âŸ¨1+0âŸ© (Hâ‚ xs) (Tâ‚ xs) (Hâ‚€ ys) (Tâ‚€ ys)

  0â†’âŸ¨1+0âŸ© : â„• â†’ 0â‰¤ ğ”¹â‚€ â†’ â„• â†’ ğ”¹â‚ â†’ ğ”¹â‚
  0â†’âŸ¨1+0âŸ© zero     xs zero     ys = sucâ‚ 0â†’âŸ¨1+0?âŸ© ys xs
  0â†’âŸ¨1+0âŸ© zero     xs (suc yâ‚€) ys = 0 1& 0< 0â†’âŸ¨0?+0âŸ© xs yâ‚€ ys
  0â†’âŸ¨1+0âŸ© (suc xâ‚) xs zero     ys = 0 1& 0< 0â†’âŸ¨1+1âŸ© xâ‚ xs (Hâ‚ ys) (Tâ‚ ys)
  0â†’âŸ¨1+0âŸ© (suc xâ‚) xs (suc yâ‚€) ys = sucâ‚ 0â†’âŸ¨1+0âŸ© xâ‚ xs yâ‚€ ys

  0â†’âŸ¨1+1âŸ© : â„• â†’ 0â‰¤ ğ”¹â‚€ â†’ â„• â†’ 0â‰¤ ğ”¹â‚€ â†’ ğ”¹â‚€
  0â†’âŸ¨1+1âŸ© zero     xs zero     ys = 0 0& 1â†’âŸ¨0?+0?âŸ© xs ys
  0â†’âŸ¨1+1âŸ© zero     xs (suc yâ‚) ys = sucâ‚€ 1â†’âŸ¨1+0?âŸ© yâ‚ ys xs
  0â†’âŸ¨1+1âŸ© (suc xâ‚) xs zero     ys = sucâ‚€ 1â†’âŸ¨1+0?âŸ© xâ‚ xs ys
  0â†’âŸ¨1+1âŸ© (suc xâ‚) xs (suc yâ‚) ys = 0 0& 0â†’âŸ¨1+1âŸ©â€² xâ‚ xs yâ‚ ys

  0â†’âŸ¨1+1âŸ©â€² : â„• â†’ 0â‰¤ ğ”¹â‚€ â†’ â„• â†’ 0â‰¤ ğ”¹â‚€ â†’ ğ”¹â‚
  0â†’âŸ¨1+1âŸ©â€² zero     xs zero     ys = sucâ‚ 1â†’âŸ¨0?+0?âŸ© xs ys
  0â†’âŸ¨1+1âŸ©â€² zero     xs (suc yâ‚) ys = 0 1& 0< 1â†’âŸ¨1+0?âŸ© yâ‚ ys xs
  0â†’âŸ¨1+1âŸ©â€² (suc xâ‚) xs zero     ys = 0 1& 0< 1â†’âŸ¨1+0?âŸ© xâ‚ xs ys
  0â†’âŸ¨1+1âŸ©â€² (suc xâ‚) xs (suc yâ‚) ys = sucâ‚ 0â†’âŸ¨1+1âŸ©â€² xâ‚ xs yâ‚ ys

  1â†’âŸ¨0?+0âŸ© : 0â‰¤ ğ”¹â‚€ â†’ â„• â†’ ğ”¹â‚ â†’ ğ”¹â‚
  1â†’âŸ¨0?+0âŸ© 0â‚‚ = carry
  1â†’âŸ¨0?+0âŸ© (0< xs) = 1â†’âŸ¨0+0âŸ© (Hâ‚€ xs) (Tâ‚€ xs)

  1â†’âŸ¨0?+0?âŸ© : 0â‰¤ ğ”¹â‚€ â†’ 0â‰¤ ğ”¹â‚€ â†’ ğ”¹â‚
  1â†’âŸ¨0?+0?âŸ© 0â‚‚ 0â‚‚ = 0 1& 0â‚‚
  1â†’âŸ¨0?+0?âŸ© 0â‚‚ (0< xs) = carry (Hâ‚€ xs) (Tâ‚€ xs)
  1â†’âŸ¨0?+0?âŸ© (0< xs) 0â‚‚ = carry (Hâ‚€ xs) (Tâ‚€ xs)
  1â†’âŸ¨0?+0?âŸ© (0< xs) (0< ys) = 1â†’âŸ¨0+0âŸ© (Hâ‚€ xs) (Tâ‚€ xs) (Hâ‚€ ys) (Tâ‚€ ys)

  1â†’âŸ¨0+0âŸ© : â„• â†’ ğ”¹â‚ â†’ â„• â†’ ğ”¹â‚ â†’ ğ”¹â‚
  1â†’âŸ¨0+0âŸ© zero     xs zero     ys = 0 1& 0< 0â†’âŸ¨1+1âŸ© (Hâ‚ xs) (Tâ‚ xs) (Hâ‚ ys) (Tâ‚ ys)
  1â†’âŸ¨0+0âŸ© zero     xs (suc yâ‚€) ys = sucâ‚ 0â†’âŸ¨1+0âŸ© (Hâ‚ xs) (Tâ‚ xs) yâ‚€ ys
  1â†’âŸ¨0+0âŸ© (suc xâ‚€) xs zero     ys = sucâ‚ 0â†’âŸ¨1+0âŸ© (Hâ‚ ys) (Tâ‚ ys) xâ‚€ xs
  1â†’âŸ¨0+0âŸ© (suc xâ‚€) xs (suc yâ‚€) ys = 0 1& 0< 0â†’âŸ¨0+0âŸ© xâ‚€ xs yâ‚€ ys

  1â†’âŸ¨1+0?âŸ© : â„• â†’ 0â‰¤ ğ”¹â‚€ â†’ 0â‰¤ ğ”¹â‚€ â†’ ğ”¹â‚€
  1â†’âŸ¨1+0?âŸ© x xs 0â‚‚ = x 0& incâ‰¤ xs
  1â†’âŸ¨1+0?âŸ© x xs (0< ys) = 1â†’âŸ¨1+0âŸ© x xs (Hâ‚€ ys) (Tâ‚€ ys)

  1â†’âŸ¨1+0âŸ© : â„• â†’ 0â‰¤ ğ”¹â‚€ â†’ â„• â†’ ğ”¹â‚ â†’ ğ”¹â‚€
  1â†’âŸ¨1+0âŸ© zero     xs zero     ys = sucâ‚€ 1â†’âŸ¨1+0?âŸ© (Hâ‚ ys) (Tâ‚ ys) xs
  1â†’âŸ¨1+0âŸ© zero     xs (suc yâ‚€) ys = 0 0& 1â†’âŸ¨0?+0âŸ© xs yâ‚€ ys
  1â†’âŸ¨1+0âŸ© (suc xâ‚) xs zero     ys = 0 0& 1â†’âŸ¨1+1âŸ© xâ‚ xs (Hâ‚ ys) (Tâ‚ ys)
  1â†’âŸ¨1+0âŸ© (suc xâ‚) xs (suc yâ‚€) ys = sucâ‚€ 1â†’âŸ¨1+0âŸ© xâ‚ xs yâ‚€ ys

  1â†’âŸ¨1+1âŸ© : â„• â†’ 0â‰¤ ğ”¹â‚€ â†’ â„• â†’ 0â‰¤ ğ”¹â‚€ â†’ ğ”¹â‚
  1â†’âŸ¨1+1âŸ© zero     xs zero     ys = sucâ‚ 1â†’âŸ¨0?+0?âŸ© xs ys
  1â†’âŸ¨1+1âŸ© zero     xs (suc yâ‚) ys = 0 1& 0< 1â†’âŸ¨1+0?âŸ© yâ‚ ys xs
  1â†’âŸ¨1+1âŸ© (suc xâ‚) xs zero     ys = 0 1& 0< 1â†’âŸ¨1+0?âŸ© xâ‚ xs ys
  1â†’âŸ¨1+1âŸ© (suc xâ‚) xs (suc yâ‚) ys = sucâ‚ 1â†’âŸ¨1+1âŸ© xâ‚ xs yâ‚ ys

  carry : â„• â†’ ğ”¹â‚ â†’ ğ”¹â‚
  carry zero     xs = sucâ‚ xs
  carry (suc xâ‚€) xs = 0 1& 0< xâ‚€ 0& xs

infixl 6 _+_
_+_ : ğ”¹ â†’ ğ”¹ â†’ ğ”¹
0â‚‚         + ys         = ys
(0< xs)    + 0â‚‚         = 0< xs
(0< Bâ‚€ xs) + (0< Bâ‚€ ys) = 0< Bâ‚€ 0â†’âŸ¨0+0âŸ© (Hâ‚€ xs) (Tâ‚€ xs) (Hâ‚€ ys) (Tâ‚€ ys)
(0< Bâ‚€ xs) + (0< Bâ‚ ys) = 0< Bâ‚ 0â†’âŸ¨1+0âŸ© (Hâ‚ ys) (Tâ‚ ys) (Hâ‚€ xs) (Tâ‚€ xs)
(0< Bâ‚ xs) + (0< Bâ‚€ ys) = 0< Bâ‚ 0â†’âŸ¨1+0âŸ© (Hâ‚ xs) (Tâ‚ xs) (Hâ‚€ ys) (Tâ‚€ ys)
(0< Bâ‚ xs) + (0< Bâ‚ ys) = 0< Bâ‚€ 0â†’âŸ¨1+1âŸ© (Hâ‚ xs) (Tâ‚ xs) (Hâ‚ ys) (Tâ‚ ys)
