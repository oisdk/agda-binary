{-# OPTIONS --without-K --safe #-}

module Data.Binary.Operations.Addition where

open import Data.Binary.Definitions
open import Data.Binary.Operations.Unary
open import Data.Nat as â„• using (â„•; suc; zero)

mutual
  0â†’âŸ¨0?+0âŸ© : 0â‰¤ ğ”¹â‚€ â†’ â„• â†’ ğ”¹â‚ â†’ ğ”¹â‚€
  0â†’âŸ¨0?+0âŸ© 0â‚‚ yâ‚€ ys = yâ‚€ 0& ys
  0â†’âŸ¨0?+0âŸ© (0< xâ‚€ 0& xs) yâ‚€ ys = 0â†’âŸ¨0+0âŸ© 0 xâ‚€ xs yâ‚€ ys

  0â†’âŸ¨0+0âŸ© : â„• â†’ â„• â†’ ğ”¹â‚ â†’ â„• â†’ ğ”¹â‚ â†’ ğ”¹â‚€
  0â†’âŸ¨0+0âŸ© c zero     (xâ‚ 1& xs) zero     (yâ‚ 1& ys) = 0â†’âŸ¨1+1âŸ© (suc c) xâ‚ xs yâ‚ ys
  0â†’âŸ¨0+0âŸ© c zero     (xâ‚ 1& xs) (suc yâ‚€) ys         = c 0& 0â†’âŸ¨1+0âŸ© 0 xâ‚ xs yâ‚€ ys
  0â†’âŸ¨0+0âŸ© c (suc xâ‚€) xs         zero     (yâ‚ 1& ys) = c 0& 0â†’âŸ¨1+0âŸ© 0 yâ‚ ys xâ‚€ xs
  0â†’âŸ¨0+0âŸ© c (suc xâ‚€) xs         (suc yâ‚€) ys         = 0â†’âŸ¨0+0âŸ© (suc c) xâ‚€ xs yâ‚€ ys

  0â†’âŸ¨1+0?âŸ© : â„• â†’ â„• â†’ 0â‰¤ ğ”¹â‚€ â†’ 0â‰¤ ğ”¹â‚€ â†’ ğ”¹â‚
  0â†’âŸ¨1+0?âŸ© c xâ‚ xs 0â‚‚ = c â„•.+ xâ‚ 1& xs
  0â†’âŸ¨1+0?âŸ© c xâ‚ xs (0< yâ‚€ 0& ys) = 0â†’âŸ¨1+0âŸ© c xâ‚ xs yâ‚€ ys

  0â†’âŸ¨1+0âŸ© : â„• â†’ â„• â†’ 0â‰¤ ğ”¹â‚€ â†’ â„• â†’ ğ”¹â‚ â†’ ğ”¹â‚
  0â†’âŸ¨1+0âŸ© c zero     xs zero     (yâ‚ 1& ys) = 0â†’âŸ¨1+0?âŸ© (suc c) yâ‚ ys xs
  0â†’âŸ¨1+0âŸ© c zero     xs (suc yâ‚€) ys         = c 1& 0< 0â†’âŸ¨0?+0âŸ© xs yâ‚€ ys
  0â†’âŸ¨1+0âŸ© c (suc xâ‚) xs zero     (yâ‚ 1& ys) = c 1& 0< 0â†’âŸ¨1+1âŸ© 0 xâ‚ xs yâ‚ ys
  0â†’âŸ¨1+0âŸ© c (suc xâ‚) xs (suc yâ‚€) ys         = 0â†’âŸ¨1+0âŸ© (suc c) xâ‚ xs yâ‚€ ys

  0â†’âŸ¨1+1âŸ© : â„• â†’ â„• â†’ 0â‰¤ ğ”¹â‚€ â†’ â„• â†’ 0â‰¤ ğ”¹â‚€ â†’ ğ”¹â‚€
  0â†’âŸ¨1+1âŸ© c zero     xs zero     ys = c 0& 1â†’âŸ¨0?+0?âŸ© 0 xs ys
  0â†’âŸ¨1+1âŸ© c zero     xs (suc yâ‚) ys = 1â†’âŸ¨1+0?âŸ© (suc c) yâ‚ ys xs
  0â†’âŸ¨1+1âŸ© c (suc xâ‚) xs zero     ys = 1â†’âŸ¨1+0?âŸ© (suc c) xâ‚ xs ys
  0â†’âŸ¨1+1âŸ© c (suc xâ‚) xs (suc yâ‚) ys = c 0& 0â†’âŸ¨1+1âŸ©â€² 0 xâ‚ xs yâ‚ ys

  0â†’âŸ¨1+1âŸ©â€² : â„• â†’ â„• â†’ 0â‰¤ ğ”¹â‚€ â†’ â„• â†’ 0â‰¤ ğ”¹â‚€ â†’ ğ”¹â‚
  0â†’âŸ¨1+1âŸ©â€² c zero     xs zero     ys = 1â†’âŸ¨0?+0?âŸ© (suc c) xs ys
  0â†’âŸ¨1+1âŸ©â€² c zero     xs (suc yâ‚) ys = c 1& 0< 1â†’âŸ¨1+0?âŸ© 0 yâ‚ ys xs
  0â†’âŸ¨1+1âŸ©â€² c (suc xâ‚) xs zero     ys = c 1& 0< 1â†’âŸ¨1+0?âŸ© 0 xâ‚ xs ys
  0â†’âŸ¨1+1âŸ©â€² c (suc xâ‚) xs (suc yâ‚) ys = 0â†’âŸ¨1+1âŸ©â€² (suc c) xâ‚ xs yâ‚ ys

  1â†’âŸ¨0?+0âŸ© : â„• â†’ 0â‰¤ ğ”¹â‚€ â†’ â„• â†’ ğ”¹â‚ â†’ ğ”¹â‚
  1â†’âŸ¨0?+0âŸ© c 0â‚‚ yâ‚€ ys = carry c (yâ‚€ 0& ys)
  1â†’âŸ¨0?+0âŸ© c (0< xâ‚€ 0& xs) yâ‚€ ys = 1â†’âŸ¨0+0âŸ© c xâ‚€ xs yâ‚€ ys

  1â†’âŸ¨0?+0?âŸ© : â„• â†’ 0â‰¤ ğ”¹â‚€ â†’ 0â‰¤ ğ”¹â‚€ â†’ ğ”¹â‚
  1â†’âŸ¨0?+0?âŸ© c 0â‚‚ 0â‚‚ = c 1& 0â‚‚
  1â†’âŸ¨0?+0?âŸ© c 0â‚‚ (0< xs) = carry c xs
  1â†’âŸ¨0?+0?âŸ© c (0< xs) 0â‚‚ = carry c xs
  1â†’âŸ¨0?+0?âŸ© c (0< xâ‚€ 0& xs) (0< yâ‚€ 0& ys) = 1â†’âŸ¨0+0âŸ© c xâ‚€ xs yâ‚€ ys

  1â†’âŸ¨0+0âŸ© : â„• â†’ â„• â†’ ğ”¹â‚ â†’ â„• â†’ ğ”¹â‚ â†’ ğ”¹â‚
  1â†’âŸ¨0+0âŸ© c zero     (xâ‚ 1& xs) zero     (yâ‚ 1& ys) = c 1& 0< 0â†’âŸ¨1+1âŸ© 0 xâ‚ xs yâ‚ ys
  1â†’âŸ¨0+0âŸ© c zero     (xâ‚ 1& xs) (suc yâ‚€) ys         = 0â†’âŸ¨1+0âŸ© (suc c) xâ‚ xs yâ‚€ ys
  1â†’âŸ¨0+0âŸ© c (suc xâ‚€) xs         zero     (yâ‚ 1& ys) = 0â†’âŸ¨1+0âŸ© (suc c) yâ‚ ys xâ‚€ xs
  1â†’âŸ¨0+0âŸ© c (suc xâ‚€) xs         (suc yâ‚€) ys         = c 1& 0< 0â†’âŸ¨0+0âŸ©â€² 0 xâ‚€ xs yâ‚€ ys

  0â†’âŸ¨0+0âŸ©â€² : â„• â†’ â„• â†’ ğ”¹â‚ â†’ â„• â†’ ğ”¹â‚ â†’ ğ”¹â‚€
  0â†’âŸ¨0+0âŸ©â€² c zero     (xâ‚ 1& xs) zero     (yâ‚ 1& ys) = 0â†’âŸ¨1+1âŸ© (suc c) xâ‚ xs yâ‚ ys
  0â†’âŸ¨0+0âŸ©â€² c zero     (xâ‚ 1& xs) (suc yâ‚€) ys         = c 0& 0â†’âŸ¨1+0âŸ© 0 xâ‚ xs yâ‚€ ys
  0â†’âŸ¨0+0âŸ©â€² c (suc xâ‚€) xs         zero     (yâ‚ 1& ys) = c 0& 0â†’âŸ¨1+0âŸ© 0 yâ‚ ys xâ‚€ xs
  0â†’âŸ¨0+0âŸ©â€² c (suc xâ‚€) xs         (suc yâ‚€) ys         = 0â†’âŸ¨0+0âŸ©â€² (suc c) xâ‚€ xs yâ‚€ ys

  1â†’âŸ¨1+0?âŸ© : â„• â†’ â„• â†’ 0â‰¤ ğ”¹â‚€ â†’ 0â‰¤ ğ”¹â‚€ â†’ ğ”¹â‚€
  1â†’âŸ¨1+0?âŸ© c x xs 0â‚‚ = (c â„•.+ x) 0& incâ‚ xs
  1â†’âŸ¨1+0?âŸ© c x xs (0< yâ‚€ 0& ys) = 1â†’âŸ¨1+0âŸ© c x xs yâ‚€ ys

  1â†’âŸ¨1+0âŸ© : â„• â†’ â„• â†’ 0â‰¤ ğ”¹â‚€ â†’ â„• â†’ ğ”¹â‚ â†’ ğ”¹â‚€
  1â†’âŸ¨1+0âŸ© c zero     xs zero     (yâ‚ 1& ys) = 1â†’âŸ¨1+0?âŸ© (suc c) yâ‚ ys xs
  1â†’âŸ¨1+0âŸ© c zero     xs (suc yâ‚€) ys         = c 0& 1â†’âŸ¨0?+0âŸ© 0 xs yâ‚€ ys
  1â†’âŸ¨1+0âŸ© c (suc xâ‚) xs zero     (yâ‚ 1& ys) = c 0& 1â†’âŸ¨1+1âŸ© 0 xâ‚ xs yâ‚ ys
  1â†’âŸ¨1+0âŸ© c (suc xâ‚) xs (suc yâ‚€) ys         = 1â†’âŸ¨1+0âŸ© (suc c) xâ‚ xs yâ‚€ ys

  1â†’âŸ¨1+1âŸ© : â„• â†’ â„• â†’ 0â‰¤ ğ”¹â‚€ â†’ â„• â†’ 0â‰¤ ğ”¹â‚€ â†’ ğ”¹â‚
  1â†’âŸ¨1+1âŸ© c zero     xs zero     ys = 1â†’âŸ¨0?+0?âŸ© (suc c) xs ys
  1â†’âŸ¨1+1âŸ© c zero     xs (suc yâ‚) ys = c 1& 0< 1â†’âŸ¨1+0?âŸ© 0 yâ‚ ys xs
  1â†’âŸ¨1+1âŸ© c (suc xâ‚) xs zero     ys = c 1& 0< 1â†’âŸ¨1+0?âŸ© 0 xâ‚ xs ys
  1â†’âŸ¨1+1âŸ© c (suc xâ‚) xs (suc yâ‚) ys = 1â†’âŸ¨1+1âŸ© (suc c) xâ‚ xs yâ‚ ys

  carry : â„• â†’ ğ”¹â‚€ â†’ ğ”¹â‚
  carry n (zero  0& y 1& xs) = suc (n â„•.+ y) 1& xs
  carry n (suc x 0& y 1& xs) = n 1& 0< x 0& y 1& xs

infixl 6 _+_
_+_ : ğ”¹ â†’ ğ”¹ â†’ ğ”¹
0â‚‚               + ys               = ys
(0< xs)          + 0â‚‚               = 0< xs
(0< Bâ‚€ xâ‚€ 0& xs) + (0< Bâ‚€ yâ‚€ 0& ys) = 0< Bâ‚€ 0â†’âŸ¨0+0âŸ© 0 xâ‚€ xs yâ‚€ ys
(0< Bâ‚€ xâ‚€ 0& xs) + (0< Bâ‚ yâ‚ 1& ys) = 0< Bâ‚ 0â†’âŸ¨1+0âŸ© 0 yâ‚ ys xâ‚€ xs
(0< Bâ‚ xâ‚ 1& xs) + (0< Bâ‚€ yâ‚€ 0& ys) = 0< Bâ‚ 0â†’âŸ¨1+0âŸ© 0 xâ‚ xs yâ‚€ ys
(0< Bâ‚ xâ‚ 1& xs) + (0< Bâ‚ yâ‚ 1& ys) = 0< Bâ‚€ 0â†’âŸ¨1+1âŸ© 0 xâ‚ xs yâ‚ ys
